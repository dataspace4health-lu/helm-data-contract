# -- Default number of instances to start 
replicaCount: 1
# -- Application name
name: dct
# -- Ovverwrites application name
# nameOverride: ""

image:
  # repository: registry.gitlab.com/gaia-x/data-infrastructure-federation-services
  repository: ds4h-registry:5432
  # -- Image name
  name: dct/dct
  # -- Image tag
  # Uses .Chart.AppVersion if empty
  #tag: "3ee4b875"
  tag: latest
  # -- Image sha, usually generated by the CI
  # Uses image.tag if empty
  sha: ""
  # -- Image pull policy
  #pullPolicy: IfNotPresent
  pullPolicy: Always
  # -- Image pull secret when internal image is used
  pullSecrets:
  # command: 
  #   - "/bin/sh"
  # args: 
    # - "-c"
    # - |
    #   set -x

    #   rm -rf node_modules dist

    #   mkdir repo && cd repo && apk add git
    #   git clone https://gitlab.eclipse.org/eclipse/xfsc/dct/dct.git && cd dct
    #   git checkout 34a967038aa5632ea6a763f4ddf639ab0fb8a238

    #   sed -i 's|"baseHref": "/ui/",|"baseHref": "/dct/",|' apps/ui/project.json
    #   sed -i 's|"outputPath": "dist/apps/ui",|"outputPath": "dist/apps/ui/dct",|' apps/ui/project.json
    #   sed -i 's|href="/ui/assets|href="assets|' apps/ui/src/index.html
    #   sed -i "s|<BrowserRouter basename='/ui'>|<BrowserRouter basename='/dct'>|" apps/ui/src/main.tsx
      
    #   sed -i "s|SwaggerModule.setup('swagger', app, document);|SwaggerModule.setup('dct/swagger', app, document);|" apps/api/src/main.ts
    #   sed -i "/initSwagger(app);/i\ \ app.setGlobalPrefix('dct/api');" apps/api/src/main.ts
    #   sed -i "s|/ui|/dct|" apps/api/src/app.module.ts
    #   sed -i "s|ui|ui/dct|" apps/api/src/app.module.ts

    #   npm config set @gaia-x:registry https://gitlab.com/api/v4/projects/38989724/packages/npm/
    #   npm i -g @nrwl/cli
    #   npm ci --legacy-peer-deps
    #   npm run build
    #   npm ci --only=production --legacy-peer-deps && npm cache clean --force

    #   mv dist / && mv node_modules / && cd / && rm -rf repo
    #   node dist/apps/api/main.js

## Use configMap or secretRef for environment variables
# useConfigMap: false
# configMapName: my-configmap
# useSecretRef: false
# secretRefName: my-secret

podAnnotations: {}
##
## Pass extra environment variables to the container.
##
# extraVars:
# - name: EXTRA_VAR_1
#   value: extra-var-value-1
# - name: EXTRA_VAR_2
#   value: extra-var-value-2
##
## Create new service when true, and use the specified uner name when set to the name specified
##

# resources:
#   requests:
#     cpu: 150m
#     memory: 128Mi
#   limits:
#     cpu: 300m
#     memory: 256Mi

## Configure pod autoscaling
##

autoscaling:
  # -- Enable autoscaling
  enabled: false
  # -- Minimum replicas
  minReplicas: 2
  # -- Maximum replicas
  maxReplicas: 3
  # -- CPU target for autoscaling trigger
  targetCPUUtilizationPercentage: 70
  # -- Memory target for autoscaling trigger
  targetMemoryUtilizationPercentage: 70
##
## Prometheus Exporter / Metrics
##

metrics:
  # -- Enable prometheus metrics
  enabled: false #true
  # -- Port for prometheus metrics
  port: 2112

log:
  level: "debug"
  encoding: json

##
## Kubernetes [SecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/) object.
##

security:
  # -- by default, apps run as non-root
  runAsNonRoot: false
  # -- User used by the apps
  runAsUid: 0
  # -- Group used by the apps
  runAsGid: 0
##
##
service:
  port: 8080

config:
  environment: development
  api:
    basePath: /dct/api

  delUrl: "https://del-dev3.gxfs.dev/inbox"
  delIdUrl: "https://dcs.gaia-x.com/contracts/1001"
  delInboxUrl: "https://del-dev3.gxfs.dev/inbox"

  didResolverServiceUrl: "https://trust-service.com"
  federatedCatalogUrl: "http://dataspace4health.local/catalogue"
  signatureId: "did:web:dataspace4health.local:wallet:api:wallet-api:registry:0"
  proofType: "LD_PROOF"
  proofPurpose: "assertionMethod"
  signatureType: "JsonWebSignature2020"
  signatureController: "did:dcs:controller"
  signaturePublicKeyBase58: "45dxsXGjMixWNfmXBtWwPnCfGgV1THf6qhdLixUmgrVZ"
  signaturePrivateKeyBase58: "3hJ4PNJm6pzUwRLDpummeZCZGeqE7c9DMdD6qSNB4qBfxrnkAUmZ1CQMpifvihdiSv8pepijdCzR5C2eAHC4Vqf9"

  oidcIssuer: "https://dataspace4health.local/iam/realms/ds4h"
  oidcClientId: "data-contract-service"
  oidcClientSecret: "somesecretkey"
  oidcScope: "openid profile"
  oidcRedirectUri: "https://dataspace4health.local/dct/ui/callback"
  oidcResponseType: "code"
  oidcPostLogoutRedirectUri: "https://dataspace4health.local/dct/ui"
  nodeTlsRejectUnauthorized: 0
  logTokenJwtSecretKey: "somesecretkey"
  waltidSsiKitUrl: "http://iat-issuer-api:7000"

  http:
    host: ""
    port: 8080
    timeout:
      idle: 120s
      read: 10s
      write: 10s
  redis:
    host:
    port:

redis:
  enabled: true
  image:
    registry: bitnamilegacy
    repository: redis
    tag: 7.2.5-debian-12-r2
  auth:
    password: "xfsc4Ntt!"
  master:
    persistence:
      size: 5Gi
  replica:
    replicaCount: 1
    persistence:
      size: 5Gi

ingress:
  enabled: true
  hosts:
    - paths:
      - path: /dct
        port: 8080
        pathType: Prefix
  tls:
    - secretName: dataspace4health.local
      hosts:
        - dataspace4health.local

# istio:
#   injection:
#     pod: true

secretEnv:

